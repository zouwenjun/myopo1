(function(){"use strict";function e(){}function t(e,t){for(var a=e.length;a--;)if(e[a].listener===t)return a;return-1}function a(e){return function(){return this[e].apply(this,arguments)}}var i=e.prototype,n=this,o=n.EventEmitter;i.getListeners=function(e){var t,a,i=this._getEvents();if(e instanceof RegExp){t={};for(a in i)i.hasOwnProperty(a)&&e.test(a)&&(t[a]=i[a])}else t=i[e]||(i[e]=[]);return t},i.flattenListeners=function(e){var t,a=[];for(t=0;t<e.length;t+=1)a.push(e[t].listener);return a},i.getListenersAsObject=function(e){var t,a=this.getListeners(e);return a instanceof Array&&(t={},t[e]=a),t||a},i.addListener=function(e,a){var i,n=this.getListenersAsObject(e),o="object"==typeof a;for(i in n)n.hasOwnProperty(i)&&-1===t(n[i],a)&&n[i].push(o?a:{listener:a,once:!1});return this},i.on=a("addListener"),i.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},i.once=a("addOnceListener"),i.defineEvent=function(e){return this.getListeners(e),this},i.defineEvents=function(e){for(var t=0;t<e.length;t+=1)this.defineEvent(e[t]);return this},i.removeListener=function(e,a){var i,n,o=this.getListenersAsObject(e);for(n in o)o.hasOwnProperty(n)&&(i=t(o[n],a),-1!==i&&o[n].splice(i,1));return this},i.off=a("removeListener"),i.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},i.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},i.manipulateListeners=function(e,t,a){var i,n,o=e?this.removeListener:this.addListener,s=e?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(i=a.length;i--;)o.call(this,t,a[i]);else for(i in t)t.hasOwnProperty(i)&&(n=t[i])&&("function"==typeof n?o.call(this,i,n):s.call(this,i,n));return this},i.removeEvent=function(e){var t,a=typeof e,i=this._getEvents();if("string"===a)delete i[e];else if(e instanceof RegExp)for(t in i)i.hasOwnProperty(t)&&e.test(t)&&delete i[t];else delete this._events;return this},i.removeAllListeners=a("removeEvent"),i.emitEvent=function(e,t){var a,i,n,o,s=this.getListenersAsObject(e);for(n in s)if(s.hasOwnProperty(n))for(i=s[n].length;i--;)a=s[n][i],a.once===!0&&this.removeListener(e,a.listener),o=a.listener.apply(this,t||[]),o===this._getOnceReturnValue()&&this.removeListener(e,a.listener);return this},i.trigger=a("emitEvent"),i.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},i.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},i._getOnceReturnValue=function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue},i._getEvents=function(){return this._events||(this._events={})},e.noConflict=function(){return n.EventEmitter=o,e},"function"==typeof define&&define.amd?define(function(){return e}):"object"==typeof module&&module.exports?module.exports=e:n.EventEmitter=e}).call(this),window.Yo||(window.Yo={}),Yo.Product={Carousel:$("#product-carousel"),Tab:null,Comments:null},Yo.Product.swipe=function(e){(e||document.getElementById(e))&&(Yo.Product.PS=new Swipe(document.getElementById(e),{startSlide:0,speed:500,continuous:!1,disableScroll:!1,stopPropagation:!1,callback:function(e,t){Yo.Product.Carousel.find(".ps-carousel-item .ps-item").removeClass("ps-item-active"),Yo.Product.Carousel.find(".ps-carousel-item .ps-item").eq(e).addClass("ps-item-active"),Yo.Product.Carousel.trigger("to.owl.carousel",[e,500,!0])},transitionEnd:function(e,t){}}))},Yo.Product.initCarousel=function(){Yo.Product.Carousel.owlCarousel({loop:!1,margin:0,dots:!1,nav:!0,smartSpeed:500,responsiveClass:!0,responsive:{0:{items:2},500:{items:3},640:{items:4},768:{items:2},990:{items:4},1200:{items:5}},baseClass:"ps-carousel",itemClass:"ps-carousel-item",navContainerClass:"ps-carousel-nav",navClass:["ps-carousel-prev","ps-carousel-next"]}),Yo.Product.Carousel.on("changed.owl.carousel",function(e){e.target,e.item.index}),Yo.Product.Carousel.find(".ps-carousel-item").each(function(){var e=$(this);e.on("click",function(t){var a=e.index();Yo.Product.Carousel.find(".ps-carousel-item .ps-item").removeClass("ps-item-active"),Yo.Product.Carousel.find(".ps-carousel-item .ps-item").eq(a).addClass("ps-item-active"),Yo.Product.Carousel.trigger("to.owl.carousel",[a,500,!0]),Yo.Product.PS.slide(a),t.preventDefault()})})},Yo.Product.Tabs=function(){var e=new yTabs("#product-tabs",{transition:3,start:0,contain:!1,frames:"#product-detail .y-tab-frame",onStart:function(e){},onHash:function(e,t){var a=e;"comments"!=a.data("hash")||a.data("trigger")||(a.data("trigger",!0),Yo.Product.Comments.render(),Yo.Product.Comments.getRespondState())}});Yo.Product.Tab=e},Yo.Product.initAmount=function(){var e=$("#product-amount"),t=e.find("a[data-bind]"),a=e.find('[data-bind="minus"]'),i=(e.find('[data-bind="minus"]'),$("#amount-textbox")),n=1;t.each(function(){var e=$(this),t=e.attr("data-bind");e.on("click",function(e){var o=i.val();if(/^\d+$/.test(o)||i.val(1),n=parseInt(o,10)||1,"plus"===t&&(n++,n>1&&a.removeClass("disabled"),i.val(n)),"minus"===t){if(n--,n<2&&a.addClass("disabled"),!(n>=1))return;i.val(n)}e.preventDefault()})}),i.on("blur",function(e){/^\d+$/.test(i.val())||i.val(1)})},function(e){var t='<div class="y-comment-meta clearfix">      <div class="y-comment-author">            {{? it.bbs_id != undefined }}            <div class="y-comment-avator">                  <img src="http://bbs.oppo.cn/uc_server/avatar.php?uid={{? it.bbs_id }}{{=it.bbs_id}}{{??}}0{{?}}&size=middle" alt="">            </div>            {{?}}            <div class="comment-author">{{? it.user_name }}<span>{{=it.user_name}}</span>{{?}}{{? it.created_at }}<em>{{=it.created_at}}</em>{{?}}</div>      </div>      {{? it.score }}      <div class="y-comment-metadata">            <span class="y-comment-stars">                  <span class="stars star-{{=it.score}}"></span>            </span>      </div>      {{?}}</div><div class="y-comment-content">{{=it.comment}}</div>{{? it.upload_images }}<div class="y-comment-gallery" data-bind="gallery">    <div class="gallery-grid">        <ul>            {{~it.upload_images :value:index}}            <li{{? index == 0}} class="fore"{{?}} data-image="{{=value.image}}"><a href="javascript:;"><div class="thumbnail"><img src="{{=value.thumbnail}}" alt=""></div></a><i></i></li>            {{~}}        </ul>    </div>    <div class="gallery-viewer" style="display: none;"><i></i></div></div>{{?}}',a='<div class="y-comment-meta">     <div class="comment-label">\u5b98\u65b9\u56de\u590d:&nbsp;&nbsp;<span>{{=it.comment}}</span></div>     <div class="comment-date">{{=it.created_at}}</div></div><div class="y-comment-content">{{=it.comment}}</div>',i='<div class="y-comment-meta">     <div class="comment-label">\u8ffd\u52a0\u8bc4\u8bba:&nbsp;&nbsp;<span>{{=it.comment}}</span></div>     <div class="comment-date">{{=it.created_at}}</div></div><div class="y-comment-content">{{=it.comment}}</div>{{? it.upload_images }}<div class="y-comment-gallery" data-bind="gallery">    <div class="gallery-grid">        <ul>            {{~it.upload_images :value:index}}            <li{{? index == 0}} class="fore"{{?}} data-image="{{=value.image}}"><a href="javascript:;"><div class="thumbnail"><img src="{{=value.thumbnail}}" alt=""></div></a><i></i></li>            {{~}}        </ul>    </div>    <div class="gallery-viewer" style="display: none;"><i></i></div></div>{{?}}',n='<ul class="pagination">    <li class="prev"><a href="#product-detail-comments">&laquo;</a></li>    {{~it.pages :value:index}}    <li data-page="{{=value.page}}"{{?value.active}} class="active"{{?}}><a href="{{?value.active}}javascript:;{{??}}#product-detail-comments{{?}}">{{=value.text}}</a></li>    {{~}}    <li class="next"><a href="#product-detail-comments">&raquo;</a></li></ul>',o='<ul>    {{~it :value:index}}    <li class="switchable{{? index == 0}} checked{{?}}">        <a href="javascript:;" data-id="{{=value.id}}">            <span class="cb-radio"></span>            <span class="label">{{=value.comment}}</span>        </a>    </li>    {{~}}</ul>',s=[],l={max:5,currentPage:1},r={good:$("#comment-product-id"),type:$("#comment-type"),score:$("#comment-score")},d={goods_id:0,score:0,type:1},c=-1,u=function(e,t,a,i){var n=this;this.pid=e,this.base_url=Yo.base_url,this.current_url=Yo.config.product_url,this.account_url=Yo.config.account_url,this.login_url=Yo.config.login_url,this.$comments=$(t),this.$pagination=$(a),this.$respond=$(i),this.$btnGo=$("#go-comment"),this.isBtnActive=!1,this.gallerys=[],this.$total=$("#comment-total"),this.$switchable=$("#comments-switchable"),this.$loading=$("#comment-loading"),this.$submit=$("#submit-comment"),this._verified=!1,this._commentType=0,this._maxSize=l.max,this.templates={holder:'<div class="y-comment-holder">\u6682\u65f6\u6ca1\u6709\u8bc4\u8bba\uff01</div>',loading:'<div class="y-comment-loading">\u52a0\u8f7d\u8bc4\u8bba\u4e2d......</div>'},this.on("totalPages",n.getTotalPages),this.initialize()};u.prototype=new EventEmitter;var m=u.prototype;m.initialize=function(){this.getTotalCount(),this.switchable(),this.initRespond()},m.setData=function(e,t){var a=this,e=e||1,t=t||!1;a.getData(e,t,function(i){"undefined"!=typeof i.data&&i.data.length>0&&(l.totalItems=parseInt(i.total,10),l.itemsPerPage=parseInt(i.per_page,10),l.totalPages=a.calculateTotalPages(),l.currentPage=e,a._buildComments(i,t),s=a.getPages(e,l.totalPages),a.renderPages(),a.addPageEvents(),a.gallery(),"undefined"!=typeof i.typecount&&a.getCommentCount(i.typecount))})},m.gallery=function(){var e=this,t=e.$comments,a=t.find('[data-bind="gallery"]');a.length&&a.each(function(){var t=$(this),a=t.find(".gallery-grid");a.find("li").each(function(){var i=$(this);i.on("click",function(n){var o=i.index(),s=i.attr("data-image");if("undefined"!=typeof t.data("inx")){var l=t.data("inx");l!==o?(a.find("li").removeClass("active"),i.addClass("active"),e.slideTo(t,o,s)):(t.removeData("inx"),i.removeClass("active"),t.find(".gallery-viewer").hide())}else a.find("li").removeClass("active"),i.addClass("active"),e.slideTo(t,o,s);n.preventDefault()})}),t.on("click",".gallery-viewer",function(e){t.removeData("inx"),a.find("li").removeClass("active"),t.find(".gallery-viewer").hide(),e.preventDefault()})})},m.slideTo=function(e,t,a){var i=(e.data("inx"),e.find(".gallery-viewer"));i.find(".gallery-stage").length||i.append($('<div class="gallery-stage" />'));var n=$("<img />");n.on("load",function(){n.removeClass("lazy")}),n.attr("src",a).addClass("lazy"),i.find(".gallery-stage").empty().append(n),e.data("inx",t),i.show()},m.switchable=function(){var e=this,t=e.$comments,a=e.$pagination;e.$switchable.find("li").each(function(){var i=$(this),n=i.find("a").attr("data-type");i.find("a").on("click",function(o){e.$switchable.find("li").removeClass("checked"),n&&!i.hasClass("checked")&&(i.addClass("checked"),a.hide(),t.html(e.templates.holder),e.$switchable.attr("data-type",n),e.setData(1,n)),o.preventDefault()})})},m.getCommentCount=function(e){var t,a=this,e=e;for(t in e)if("undefined"!=typeof t){var i=a.$switchable.find('.reviews-count[data-type="'+t+'"]');i.html("\uff08"+e[t]+"\uff09")}},m.getData=function(e,t,a){var i,n=this,e=e||1,o=n.$comments,t=t||!1;o.html(n.templates.loading);var s={page:e};return t&&(s.type=t),$.ajax({url:n.current_url+"comments/",data:s,dataType:"jsonp"}).then(function(e){i=e}).fail(function(){n.$pagination.hide(),o.html(n.templates.holder)}).done(function(){"undefined"!=typeof i.data&&"undefined"!=typeof i.data.data&&i.data.data.length>0?a&&a.call(null,i.data):(n.$pagination.hide(),o.html(n.templates.holder))}),i},m.render=function(){this.setData(1,"all")},m.getTotalCount=function(){var e,t=this,a=0;$.ajax({url:t.current_url+"totalComments/",dataType:"jsonp"}).then(function(t){e=t}).done(function(){"undefined"!=typeof e.data&&"200"==e.status&&(a=parseInt(e.data||0,10),t.$total.html("("+a+")"))})},m._buildComments=function(e,t){var a=this,i=e,n=(a.$total,i.total,i.data||[]);a.$comments.html(""),$.each(n,function(e,t){a.addNode(t)})},m.addNode=function(e,t,a){var i=this,n=i._buildNode(e);void 0==t||0==t.length?i._attachNode($(n),void 0,a):i._attachNode($(n),$(t),a),void 0!=e.children&&$.each(e.children,function(e,t){i.addNode(t,n)})},m._buildNode=function(e){var n=$("<li/>");n.attr("class","comment-leaf");var o=$("<article/>");if(o.attr("class","y-comment-body"),e.upload_images){var s=e.upload_images,l=s.split("|")||[],r=0,d=l.length;for(e.upload_images=[];r<d;r++){var c=l[r].split(",")||[];e.upload_images.push({thumbnail:c[0],image:c[1]})}}var u=doT.template(t),m=u(e);if(o.html(m),n.append(o),e.comment_append.length>0){var p=$("<article/>");p.attr("class","y-comment-body comment-append");var f=e.comment_append[0];if(f.upload_images){var s=f.upload_images;f.upload_images=[];for(var l=s.split("|")||[],r=0,d=l.length;r<d;r++){var c=l[r].split(",")||[];f.upload_images.push({thumbnail:c[0],image:c[1]})}}p.html(doT.template(i)(f)),n.append(p)}if(e.comment_reply.length>0){var v=$("<article/>");v.attr("class","y-comment-body comment-reply"),v.html(doT.template(a)(e.comment_reply[0])),n.append(v)}return n},m._attachLi=function(e,t,a){var i=t.find("ul:first");i.length?void 0==a||i.children("li").length<a?i.append(e):(0==a&&(a+=1),i.children("li:nth-child("+a+")").before(e)):(i=$("<ul/>"),i.attr("class","y-comment-list"),t.append(i.append(e)))},m._attachNode=function(e,t,a){if(void 0==t){var i=this.$comments;this._attachLi(e,i,a)}else{var i=t;this._attachLi(e,i,a),i.removeClass("comment-leaf").find("ul").removeClass("y-comment-list").addClass("y-comment-children")}},m.calculateTotalPages=function(){var e=l.totalItems,t=l.itemsPerPage,a=t<1?1:Math.ceil(e/t);return Math.max(a||0,1)},m.makePage=function(e,t,a){return{page:e,text:t,active:a}},m.getPages=function(e,t){var a=this,i=a._maxSize,n=[],o=1,s=t,l=i>0&&i<t;l&&(o=(Math.ceil(e/i)-1)*i+1,s=Math.min(o+i-1,t));for(var r=o;r<=s;r++){var d=a.makePage(r,r,r===e);n.push(d)}if(l&&l<t){if(o>1){var c=a.makePage(o-1,"...",!1);n.unshift(c)}if(s<t){var u=a.makePage(s+1,"...",!1);n.push(u)}}return n},m.renderPages=function(){var e=this,t={pages:s},a=doT.template(n),i=a(t);e.$pagination.html(i)},m.addPageEvents=function(){var e=this,t=l.currentPage,a=e.$pagination,i=a.find("li"),n=e._maxSize,t=l.currentPage,o=l.totalPages,s=a.find("li.prev"),r=a.find("li.next");1===o?a.hide():a.show(),n>=o&&(s.hide(),r.hide()),t<2&&s.hide(),t===o&&r.hide(),i.each(function(){var a=$(this);a.hasClass("prev")&&a.on("click",function(a){t>1&&e.goPage(t-1)}),a.hasClass("next")&&a.on("click",function(a){t<o&&e.goPage(t+1)}),a.attr("data-page")&&a.on("click",function(i){var n=parseInt(a.attr("data-page"),10);n!=t&&e.goPage(n)})})},m.goPage=function(e){var t=this,a=t.$switchable.attr("data-type")||"all";t.setData(e,a)},m.initRespond=function(){this.ratingTo(),this.setRespondData(),this.goRespond(),this.postRespond()},m.setRespondData=function(){d.goods_id=r.good.val()},m.ratingTo=function(){var e=this,t=e.$respond,a=t.find('[data-bind="rating"]');a.find("a").each(function(){var e=$(this);e.on("click",function(t){a.find("a").removeClass("active"),e.addClass("active"),c=e.index();var i=c+1;r.score.val(i),d.score=i,t.preventDefault()})}),a.on("mouseenter",function(e){c=a.find("a.active").index(),a.find("a").removeClass("active")}).on("mouseleave",function(e){c>-1&&a.find("a").eq(c).addClass("active")})},m.ping=function(e){var t,a=this;$.ajax({url:a.base_url+"products/comments/check/",data:{goods_id:d.goods_id,type:d.type},dataType:"jsonp"}).then(function(e){t=e}).done(function(){e&&e.call(null,t)})},m.postRespond=function(){var e=this,t=e.$submit,a=$("#cancel-comment");e.$respond;a.on("click",function(t){e.cancelConfirm(),t.preventDefault()}),t.on("click",function(t){e.validate(),e._verified&&e.actionForm(),t.preventDefault()})},m.cancelConfirm=function(){var e=this,t=e.$respond,a=$("#modal-cancel"),i=($("#modal-cancel").modal(),$("#comments-upload-list"));a.find(".confirm-button").on("click",function(n){i.length&&(i.empty(),$("#comments-file").removeClass("upload-button-disabled")),Yo.Product.CommentsUpload&&Yo.Product.CommentsUpload.refresh(),t.hide(),a.find(".y-modal-close .close").trigger("click"),e.$loading.hide(),e.$submit.show(),n.preventDefault()}),a.find(".cancel-button").on("click",function(e){a.find(".y-modal-close .close").trigger("click"),e.preventDefault()})},m.actionForm=function(){var t,a=this,i=d,n=$("#comment"),o=a.$respond,s=a._commentType,l=$("#comments-upload-list"),u=[];a.$submit.hide(),a.$loading.show(),2==s&&(delete i.score,i.comment_id=$("#comment-id").val()||0,i.type=2),l.find("li").length>0&&(l.find("li").each(function(){var e=$(this);e.attr("data-id")&&u.push(e.attr("data-id"))}),i.archive_ids=u.join("|")),i.comment=n.val(),$.ajax({url:a.base_url+"products/comments/create/",type:"POST",data:i,dataType:"json"}).then(function(e){t=e}).done(function(){var s=t.status,u=t.message;if("201"===s){var m=e.encodeURIComponent(e.location.href);e.location.href=a.login_url+"?callback="+m}"200"===s&&(a.getRespondState(),$("#comment-list").html(""),new Modal(u),o.find('[data-bind="rating"]').find("a").removeClass("active"),r.score.val(0),d.score=0,c=-1,n.val(""),l.length&&(l.empty(),$("#comments-file").removeClass("upload-button-disabled"),delete i.archive_ids),Yo.Product.CommentsUpload&&Yo.Product.CommentsUpload.refresh(),a.setData(1),o.hide()),"400"===s&&(a.getRespondState(),new Modal(u)),a.$loading.hide(),a.$submit.show()}).fail(function(){a.$loading.hide(),a.$submit.show()})},m.validate=function(){var e=this,t=$("#comment"),a=e._commentType;return e._verified=!1,1==a&&d.score<1?void new Modal("\u8bf7\u7ed9\u51fa\u8bc4\u5206\uff01"):""===t.val()?void new Modal("\u8bc4\u4ef7\u5185\u5bb9\u4e0d\u80fd\u4e3a\u7a7a\uff01"):t.val().length>200?void new Modal("\u8bc4\u4ef7\u5185\u5bb9\u4e0d\u80fd\u8d85\u8fc7200\u5b57\uff01"):void(e._verified=!0)},m.getRespondState=function(){var e=this;e.$btnGo;e.ping(function(t){var a=t.status;if("200"===a||"400"===a){var i=t.data||1;e._commentType=i}})},m.getCommentList=function(e){var t,a=this;$.ajax({url:a.base_url+"products/comments/getmylist/",data:{goods_id:d.goods_id},dataType:"jsonp"}).then(function(e){t=e}).done(function(){e&&e.call(null,t)})},m.setRespond=function(){var t=this,a=t.$respond;t.ping(function(i){var n=i.status;if(t.isBtnActive=!1,"201"===n){var s=e.encodeURIComponent(e.location.href);return void(e.location.href=t.login_url+"?callback="+s)}if("200"===n){var l=t._commentType=i.data;2==l&&($("#comment-star-box").hide(),$("#comment-label").text("\u8ffd\u52a0\u8bc4\u8bba"),t.getCommentList(function(e){var a=e.data,i=a||[];if(null!=a&&"[object Object]"===Object.prototype.toString.call(a)){i=[];for(var n in a)i.push(a[n])}if($.isArray(i)&&i.length>0){$("#comment-label").text("\u8ffd\u52a0\u8bc4\u8bba\u5185\u5bb9\uff1a");var s=doT.template(o);$("#comment-list").html(s(i)),$("#comment-list-box").show(),t.bindItemsEvents(),$("#comment-id").val(i[0].id||0)}})),"undefined"==typeof Yo.Product.CommentsUpload&&(Yo.Product.CommentsUpload=new Yo.Product.Upload),a.show();var r=a.offset().top||0,d=/webkit/i.test(navigator.userAgent),c=d?document.body:"CSS1Compat"===document.compatMode?document.documentElement:document.body;return void Y.animatedScrollTo(c,r,500)}new Modal(i.message)})},m.bindItemsEvents=function(){var e=$("#comment-list");e.find("li").each(function(){var t=$(this);t.hasClass("checked")&&$("#comment-id").val(t.find("a").attr("data-id")||0),t.find("a").on("click",function(a){var i=$(this);$("#comment-id").val(i.attr("data-id")||0),e.find("li").removeClass("checked"),t.addClass("checked"),a.preventDefault()})})},m.goRespond=function(){var e=this,t=e.$btnGo;e.$respond;t.on("click",function(t){e.isBtnActive||(e.isBtnActive=!0,e.setRespond()),t.preventDefault()})},Yo.Product.Comments=u}(this),function(global){var CommentsUpload=function(){this.uploader=null,this.$uploadBtn=$("#comments-file-button"),this.$upload=$("#comments-file"),this.$list=$("#comments-upload-list"),this.$ids=$("#comment-archive-ids"),this.account_url=Yo.config.account_url,this.login_url=Yo.config.login_url,this.files=[],this._index=0,this.active=!1,this.initialize()},listTemplate='    {{~it :value:index}}    <li class="upload-thumbnail" data-id="{{=value.archiveId}}">        {{? value.thumbnailUrl }}        <div class="thumbnail">            <img src="{{=value.thumbnailUrl}}" alt="">        </div>        {{?}}        <a href="javascript:;" class="y-upload-cancel">\u53d6\u6d88</a>    </li>    {{~}}',P=CommentsUpload.prototype;P.initialize=function(){this.upload()},P.upload=function(){var self=this,$upload=self.$upload,$list=self.$list,prefix="upload_";self.uploader=new plupload.Uploader({runtimes:"html5,flash,silverlight,html4",browse_button:"comments-file",container:document.getElementById("comments-uploader-container"),url:"/products/comments/upload/"+Yo.config.product_id,flash_swf_url:"/lib/plupload/Moxie.swf",silverlight_xap_url:"/lib/plupload/Moxie.xap",multi_selection:!1,file_data_name:"files",filters:{max_file_size:"2mb",mime_types:[{title:"Image files",extensions:"jpg,png"}]}}),self.uploader.bind("FilesAdded",function(e,t){var a=$('<li class="upload-progress" id="'+prefix+t[0].id+'">0%</li>');$list.append(a),$list.is(":hidden")&&$list.show(),self.uploader.start(),$list.find("li").length>=4&&(self.uploader.disableBrowse(!0),self.$upload.addClass("upload-button-disabled"))}),self.uploader.bind("UploadProgress",function(e,t){document.getElementById(prefix+t.id).innerHTML=t.percent+"%"}),self.uploader.bind("FileUploaded",function(up,file,result){var json={};"undefined"==typeof JSON?eval("json = "+result.response):json=JSON.parse(result.response);var statusCode=json.status;if("200"==statusCode){var files=json.data.files;self.setRender(prefix+file.id,files),self.cancelUpload()}else{if("201"==statusCode){var callback_url=encodeURIComponent(window.location.href);return void(window.location.href=self.login_url+"?callback="+callback_url)}$(document.getElementById(prefix+file.id)).remove(),self.uploader.disableBrowse(!1),self.$upload.removeClass("upload-button-disabled"),alert(json.message)}}),self.uploader.bind("Error",function(e,t){var a=t.code;"-600"==a&&alert("\u5bf9\u4e0d\u8d77\uff0c\u56fe\u7247\u5927\u5c0f\u4e0d\u80fd\u8d85\u8fc72MB\uff01"),"-601"==a&&alert("\u5bf9\u4e0d\u8d77\uff0c\u60a8\u4e0a\u4f20\u7684\u56fe\u7247\u683c\u5f0f\u4e0d\u5bf9\uff01")}),self.uploader.init()},P.refresh=function(){var e=this;e.uploader&&e.uploader.disableBrowse(!1)},P._uploadFile=function(e){var t=this;t.$upload,t.$list},P.setRender=function(e,t){var a=this,t=t;a.$list;if(document.getElementById(e)&&t.length){var i=doT.template(listTemplate);$(document.getElementById(e)).replaceWith(i(t))}},P.cancelUpload=function(e){var t=this,a=$("#comments-upload-list");a.find("li").length&&a.off("click").on("click",".y-upload-cancel",function(e){$(this).parent().index();$(this).parent().remove(),t.uploader.disableBrowse(!1),t.$upload.removeClass("upload-button-disabled"),e.preventDefault()})},Yo.Product.Upload=CommentsUpload}(this),function(e){var t=' <div class="ps-carousel">     {{~it :value:index}}     <div class="ps-item {{? index == 0}} ps-item-active{{?}}">         <div class="related-box">             <div class="y-image">                 <a href="{{=value.url}}" target="_blank" data-tj="store|a|product_browse|{{=value.id}}" class="oppo-tj"><img alt="{{=value.alt}}" class="lazy" src="{{=value.rpath}}"></a>             </div>             <div class="y-heading">                 <a href="{{=value.url}}" target="_blank" data-tj="store|a|product_browse|{{=value.id}}" class="oppo-tj">{{=value.name}}</a>             </div>             <div class="y-price">                 {{? value.is_price_hidden == 0}}                 {{? value.promoted == 1}}                 <span>&yen;{{=value.promoted_price}}</span>                 &nbsp;                 <del>&yen;{{=value.price}}</del>                 {{??}}                 <em>&yen;{{=value.price}}</em>                 {{?}}                 {{?}}             </div>             {{? value.new_product != null || value.new_product == 0 }}             <i class="ribbon{{? value.new_product == 1 }} ribbon-new{{?}}{{? value.new_product == 2}} ribbon-promotion{{?}}{{? value.new_product == 3}} ribbon-cheap{{?}}"></i>             {{?}}         </div>     </div>     {{~}} </div>',a=function(){this.tabs=[],this.isMobile=!1,this.base_url=Yo.base_url,this._url=Yo.config.product_url,this.lists=$(".product-related")||[],this.initialize(),this.relatedTabs(),this.carousel()};a.prototype=new EventEmitter;var i=a.prototype;i.initialize=function(){var e=this;e.isMobile=function(){return!!~navigator.userAgent.search(/(iPhone|iPod|iPad|Android|BlackBerry|BB10|Windows Phone|Tizen|Bada)/)}()},i.relatedTabs=function(){var e=this;e.lists.each(function(t,a){var i=$(a),n=new yTabs(i.find('[data-bind="related"]'),{transition:3,start:0,useHash:!1,contain:!1,frames:i.find('[data-tab="related"]').find(".related-tab")});e.tabs.push(n)})},i.carousel=function(){var e=$(".related-carousel");0!==e.length&&e.each(function(){var e=$(this),t=e.find('[data-bind="carousel"]');t.owlCarousel({loop:!1,lazyLoad:!0,margin:0,dots:!!isMobile,nav:!0,smartSpeed:500,responsiveClass:!0,responsive:{320:{items:2},384:{items:2},1200:{items:4}},baseClass:"ps-carousel",itemClass:"ps-carousel-item",navContainerClass:"ps-carousel-nav",navClass:["ps-carousel-prev","ps-carousel-next"]})})},i.visitHistory=function(){var e=this,a=e.tabs,n=e._url,o=e.lists,s=o.find('[data-bind="related"]');o.eq(0).find('[data-bind="related"]'),a.length;1==s.eq(0).find("li").length&&s.find("li").addClass("y-tab-active"),0===o.length||o.find('[data-type="browse"]').length<1||i.getHistory(n,function(a){var i=[],a=a||[],n=a.length,l=0;if(1==s.find("li").length&&a.length<1)return void o.hide();if(a.length<1)return s.find('[data-type="browse"]').hide(),void o.find('[data-tab="related"]').find('[data-type="browse"]').hide();for(s.find('[data-type="browse"]').show();l<n;l++)a[l].url=e.base_url+"products/"+a[l].id,i.push(a[l]);var r=doT.template(t),d=r(i),c=o.find('[data-tab="related"]').find('[data-type="browse"]').find(".related-carousel");c.html(d),c.find(".ps-carousel").owlCarousel({loop:!1,lazyLoad:!0,margin:0,dots:!!isMobile,nav:!0,smartSpeed:500,responsiveClass:!0,responsive:{320:{items:2},384:{items:2},1200:{items:4}},baseClass:"ps-carousel",itemClass:"ps-carousel-item",navContainerClass:"ps-carousel-nav",navClass:["ps-carousel-prev","ps-carousel-next"]})},function(){"undefined"!=typeof $container&&$container.html("<p>\u6682\u65f6\u6ca1\u6709\u6d4f\u89c8\u8bb0\u5f55</p>")})},i.getHistory=function(e,t,a){var e=e,i={};$.ajax({url:e+"visit_history",type:"GET",timeout:5e3}).then(function(e){i=e}).done(function(){var e=i.status;"1"==e?t&&t.call(null,i.data):a&&a.call()}).fail(function(){a&&a.call()})},Yo.Product.Related=a}(this),function(e){var t=function(){this.$suits=$("#suits"),this.initialize()};t.prototype=new EventEmitter;var a=t.prototype;a.initialize=function(){this.onCheckbox(),console.info("initialize...")},a.onCheckbox=function(){var e=this,t=e.$suits,a=t.find(".s-goods");$("#collect-prices"),$("#extent-price");a.each(function(){var t=$(this),a=t.attr("data-id"),i=t.attr("data-origin"),n=t.attr("data-price"),o=t.find("label.checkbox"),s=o.find('input[type="checkbox"]'),l=o.find(".icon-checked"),r=o.find(".icon-unchecked");s.on("change",function(){s.is(":checked")?(s.attr("data-origin",i).attr("data-price",n),s.val(a),l.css("display","block"),r.hide()):(s.removeAttr("data-origin").removeAttr("data-price"),s.val(""),r.css("display","block"),l.hide()),e.calculatePrice()})})},a.calculatePrice=function(){var e=this,t=e.$suits,a=$("#collect-prices"),i=$("#extent-price"),n=t.find("input:checked"),o=parseInt(a.attr("data-promoted")||0,10),s=parseInt(a.attr("data-price")||0,10);if(n.each(function(){var e=$(this),t=parseInt(e.attr("data-origin")||0,10),a=parseInt(e.attr("data-price")||0,10);o+=a,s+=t}),n.length>0?a.html("<em>&yen;"+o.toFixed(2)+"</em><del>&yen;"+s.toFixed(2)+"</del>"):(o=parseInt(a.attr("data-promoted")||0,10),s=parseInt(a.attr("data-price")||0,10),o<s?a.html("<em>&yen;"+o.toFixed(2)+"</em><del>&yen;"+s.toFixed(2)+"</del>"):a.html("<em>&yen;"+s.toFixed(2)+"</em>")),s-o>0){var l=s-o;i.html(l.toFixed(2))}else i.html("0")},Yo.Product.Suits=t}(this),function(e){var t=function(){this.$sticky=$(".product-view-tabs"),this.$container=$(".product-view"),this.$tray=null,this.$window=$(e),this._scrollTop=this.$window.scrollTop(),this._top=this.$container.offset().top,this.initialize(),this.fire()};t.prototype=new EventEmitter;var a=t.prototype;a.initialize=function(){this.$sticky.before($('<div class="product-tabs-tray"></div>')),this.$tray=this.$container.find(".product-tabs-tray"),this.resize()},a.resize=function(){var t=this,a=t.$sticky;t._scrollTop=$(e).scrollTop(),t._top=t.$container.offset().top,t._scrollTop>t._top?(a.addClass("product-tabs-fixed"),t.$tray.show()):(t.$tray.hide(),a.removeClass("product-tabs-fixed"))},a.fire=function(){var t=this,a=t.$sticky,i=t.$tray;Y.bind(e,"resize",Y.throttle(function(){t.resize()},50)),Y.bind(e,"scroll",Y.throttle(function(){t._scrollTop=$(e).scrollTop(),t._scrollTop>t._top?(a.addClass("product-tabs-fixed"),i.is(":hidden")&&i.show()):(i.is(":visible")&&i.hide(),a.removeClass("product-tabs-fixed"))},50)),$("#sticky-go-buy").on("click",function(e){var t=$(".buying-price").offset().top||0;$("html, body").animate({scrollTop:t},500),e.preventDefault()})},Yo.Product.stickyBuy=t}(this);